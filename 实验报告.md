# 基于大数据分析的药物筛选系统 - 实验报告

## 课程设计报告

---

## 一、项目概述

### 1.1 研究背景

药物发现是一个耗时且成本高昂的过程，传统方法需要大量的实验验证。计算机辅助药物设计（CADD）和机器学习技术的发展为加速药物发现提供了新的途径。本项目旨在开发一个基于深度学习的药物虚拟筛选系统，利用MoleculeNet公开数据集进行分子性质预测。

### 1.2 项目目标

1. 实现基于深度学习的分子性质预测模型
2. 支持血脑屏障穿透性（BBBP）分类预测
3. 支持水溶解度（ESOL）回归预测
4. 开发用户友好的Web交互界面
5. 提供完整的模型评估和可视化功能

---

## 二、数据集说明

### 2.1 BBBP数据集 (Blood-Brain Barrier Penetration)

| 属性 | 描述 |
|------|------|
| **来源** | MoleculeNet (DeepChem) |
| **任务类型** | 二分类 |
| **预测目标** | 分子能否穿透血脑屏障 |
| **总样本数** | 2,039个分子 |
| **训练集** | 1,631个样本 (正例82.22%) |
| **验证集** | 204个样本 (正例54.90%) |
| **测试集** | 204个样本 (正例52.45%) |

**应用意义**: 血脑屏障（BBB）是保护大脑免受有害物质侵害的生理屏障。预测分子是否能穿透BBB对于中枢神经系统药物设计至关重要。

### 2.2 ESOL数据集 (Aqueous Solubility)

| 属性 | 描述 |
|------|------|
| **来源** | MoleculeNet - Delaney Solubility Dataset |
| **任务类型** | 回归 |
| **预测目标** | 分子的水溶解度 (log mol/L) |
| **总样本数** | 1,128个分子 |
| **训练集** | 902个样本 |
| **验证集** | 113个样本 |
| **测试集** | 113个样本 |
| **溶解度范围** | -4.23 至 2.15 log mol/L |

**应用意义**: 水溶解度是药物吸收和生物利用度的关键因素。准确预测溶解度有助于早期筛选候选药物。

---

## 三、技术方案

### 3.1 分子特征表示

采用**扩展连接性指纹 (ECFP/Morgan Fingerprint)**作为分子特征表示：

- **指纹半径**: 2 (ECFP4)
- **指纹维度**: 1024位
- **特点**: 
  - 以原子为中心，考虑局部化学环境
  - 编码分子拓扑结构信息
  - 广泛应用于药物发现领域

```python
# 特征提取代码示例
from rdkit import Chem
from rdkit.Chem import AllChem

mol = Chem.MolFromSmiles(smiles)
fp = AllChem.GetMorganFingerprintAsBitVect(mol, radius=2, nBits=1024)
```

### 3.2 模型架构

采用**多层感知机 (MLP)** 神经网络：

```
输入层 (1024) ─────┐
                   │
    ┌──────────────▼──────────────┐
    │ 全连接层 (512)              │
    │ BatchNorm → ReLU → Dropout  │
    └──────────────┬──────────────┘
                   │
    ┌──────────────▼──────────────┐
    │ 全连接层 (256)              │
    │ BatchNorm → ReLU → Dropout  │
    └──────────────┬──────────────┘
                   │
    ┌──────────────▼──────────────┐
    │ 全连接层 (128)              │
    │ BatchNorm → ReLU → Dropout  │
    └──────────────┬──────────────┘
                   │
    ┌──────────────▼──────────────┐
    │ 输出层 (1)                  │
    │ 分类: Sigmoid               │
    │ 回归: 线性输出              │
    └─────────────────────────────┘

总参数量: 690,945
```

### 3.3 训练配置

| 超参数 | BBBP模型 | ESOL模型 |
|--------|----------|----------|
| 学习率 | 0.0005 | 0.0005 |
| 批次大小 | 32 | 32 |
| Dropout | 0.5 | 0.5 |
| 优化器 | Adam | Adam |
| 损失函数 | BCEWithLogitsLoss | MSELoss |
| 早停策略 | patience=15 | patience=20 |
| 最大轮数 | 100 | 150 |

---

## 四、实验结果

### 4.1 BBBP分类模型

**测试集评估结果**:

| 指标 | 结果 |
|------|------|
| **Accuracy** | 61.27% |
| **Precision** | 59.09% |
| **Recall** | 85.05% |
| **F1-Score** | 69.73% |
| **AUC-ROC** | 65.90% |

**分析**:
- 模型具有较高的召回率(85.05%)，能够识别出大部分能穿透BBB的分子
- 精确率(59.09%)相对较低，说明存在一定的假阳性
- AUC-ROC为65.90%，高于随机猜测(50%)，模型具有一定的区分能力

### 4.2 ESOL回归模型

**测试集评估结果**:

| 指标 | 结果 |
|------|------|
| **RMSE** | 0.7570 log mol/L |
| **MAE** | 0.5687 log mol/L |
| **R²** | 0.4551 |
| **Pearson r** | 0.7316 |

**分析**:
- RMSE为0.757，预测误差在可接受范围内
- R²为0.4551，模型解释了约45.5%的方差
- Pearson相关系数为0.7316，预测值与真实值呈强正相关

---

## 五、系统功能

### 5.1 模块结构

```
drug/
├── data/                      # 数据处理模块
│   └── data_loader.py         # MoleculeNet数据加载
├── features/                  # 特征工程模块
│   └── feature_extraction.py  # 分子指纹提取
├── models/                    # 模型定义模块
│   └── drug_models.py         # MLP神经网络
├── training/                  # 训练模块
│   └── trainer.py             # 训练器(早停)
├── evaluation/                # 评估模块
│   ├── metrics.py             # 评估指标
│   └── figures/               # 可视化图表
├── inference/                 # 推理模块
│   └── predictor.py           # 预测器
├── web/                       # Web界面
│   └── app.py                 # Streamlit应用
└── saved_models/              # 模型文件
    ├── bbbp_model.pth
    └── esol_model.pth
```

### 5.2 Web界面功能

1. **单分子预测**: 输入SMILES字符串，预测BBB穿透性
2. **分子可视化**: 显示分子2D结构图
3. **性质计算**: 分子量、LogP、TPSA等
4. **Lipinski规则检查**: 评估类药性
5. **批量筛选**: 支持CSV文件批量预测

---

## 六、技术栈

| 类别 | 工具 | 版本 |
|------|------|------|
| 编程语言 | Python | 3.9.25 |
| 深度学习 | PyTorch | 2.7.1+cu118 |
| 分子处理 | RDKit | 2025.03.5 |
| 数据集 | DeepChem | 2.8.0 |
| 数据分析 | NumPy, Pandas | - |
| 可视化 | Matplotlib, Seaborn | - |
| Web框架 | Streamlit | - |
| GPU加速 | CUDA | 11.8 |
| 硬件 | NVIDIA RTX 3050 Ti | - |

---

## 七、结论与展望

### 7.1 结论

本项目成功实现了一个基于深度学习的药物筛选系统：

1. ✅ 使用真实的MoleculeNet数据集进行训练
2. ✅ 实现了BBBP分类和ESOL回归两种预测任务
3. ✅ 模型性能达到可接受水平
4. ✅ 开发了用户友好的Web交互界面
5. ✅ 支持GPU加速训练

### 7.2 局限性

1. 模型性能仍有提升空间
2. 仅使用了分子指纹特征，未考虑3D结构信息
3. 训练数据量相对较小

### 7.3 未来工作

1. 尝试更复杂的模型架构（GNN、Transformer）
2. 集成多种分子表示方法
3. 扩展支持更多预测任务（Tox21、BACE等）
4. 实现模型可解释性分析

---

## 八、参考文献

[1] Wu Z, Ramsundar B, Feinberg E N, et al. MoleculeNet: a benchmark for molecular machine learning. Chemical science, 2018, 9(2): 513-530.

[2] Rogers D, Hahn M. Extended-connectivity fingerprints. Journal of chemical information and modeling, 2010, 50(5): 742-754.

[3] Ramsundar B, Eastman P, Walters P, et al. Deep learning for the life sciences: applying deep learning to genomics, microscopy, drug discovery, and more. O'Reilly Media, 2019.

---

**完成日期**: 2025年12月22日

**运行环境**:
- OS: Windows 11
- GPU: NVIDIA GeForce RTX 3050 Ti Laptop GPU
- CUDA: 11.8
- Python: 3.9.25

---

## 附录：运行指南

### 环境配置
```bash
conda create -n drug_screen python=3.9 -y
conda activate drug_screen
pip install torch --index-url https://download.pytorch.org/whl/cu118
pip install rdkit deepchem scikit-learn pandas numpy matplotlib seaborn streamlit tqdm
```

### 训练模型
```bash
python train_full.py
```

### 启动Web界面
```bash
streamlit run web/app.py
# 访问 http://localhost:8501
```
